#{extends 'main.html' /}
#{set title:'Home' /}

<h1>HouseholdAccounts</h1>

<h2>
	<table>
		<tr><td><a href="@{Application.index}">Home</a></td><td>明細表</td></tr>
	</table>
</h2>

#{form @detailList()}
	<script>
	$(function() {
		var dates = $( "#from, #to" ).datepicker({
			defaultDate: "+1w",
			changeMonth: true,
			numberOfMonths: 1,
			showOtherMonths: true,
			selectOtherMonths: true,
			showAnim: "drop",
			changeMonth: true,
			changeYear: true,
			yearRange: '2000:2020',
			onSelect: function( selectedDate ) {
				var option = this.id == "from" ? "minDate" : "maxDate",
					instance = $( this ).data( "datepicker" ),
					date = $.datepicker.parseDate(
						instance.settings.dateFormat ||
						$.datepicker._defaults.dateFormat,
						selectedDate, instance.settings );
				dates.not( this ).datepicker( "option", option, date );
			}
		});
	});
	</script>

	<label for="from">日付範囲：</label>
	<input type="text" id="from" name="dateFr" size="13" value="${dFr}" />
	<label for="to">～</label>
	<input type="text" id="to" name="dateTo" size="13" value="${dTo}" />

	
	<input type="submit" value="絞込" />
#{/form}
	

<br>

#{if records.size() > 0}
		<table border="1">
			<tr>
				<th>日付</th>
				<th>項目</th>
			</tr>
			<!-- 取得レコード(編集可) -->
			
				<style>
				.ui-button { margin-left: -1px; }
				.ui-button-icon-only .ui-button-text { padding: 0.35em; } 
				.ui-autocomplete-input { margin: 0; padding: 0.48em 0 0.47em 0.45em; }
				</style>
				<script>
				(function( $ ) {
					$.widget( "ui.combobox", {
						_create: function() {
							var self = this,
								select = this.element.hide(),
								selected = select.children( ":selected" ),
								value = selected.val() ? selected.text() : "";
							var input = this.input = $( "<input>" )
								.insertAfter( select )
								.val( value )
								.autocomplete({
									delay: 0,
									minLength: 0,
									source: function( request, response ) {
										var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
										response( select.children( "option" ).map(function() {
											var text = $( this ).text();
											if ( this.value && ( !request.term || matcher.test(text) ) )
												return {
													label: text.replace(
														new RegExp(
															"(?![^&;]+;)(?!<[^<>]*)(" +
															$.ui.autocomplete.escapeRegex(request.term) +
															")(?![^<>]*>)(?![^&;]+;)", "gi"
														), "<strong>$1</strong>" ),
													value: text,
													option: this
												};
										}) );
									},
									select: function( event, ui ) {
										ui.item.option.selected = true;
										self._trigger( "selected", event, {
											item: ui.item.option
										});
									},
									change: function( event, ui ) {
										if ( !ui.item ) {
											var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( $(this).val() ) + "$", "i" ),
												valid = false;
											select.children( "option" ).each(function() {
												if ( $( this ).text().match( matcher ) ) {
													this.selected = valid = true;
													return false;
												}
											});
											if ( !valid ) {
												// remove invalid value, as it didn't match anything
												$( this ).val( "" );
												select.val( "" );
												input.data( "autocomplete" ).term = "";
												return false;
											}
										}
									}
								})
								.addClass( "ui-widget ui-widget-content ui-corner-left" );
			
							input.data( "autocomplete" )._renderItem = function( ul, item ) {
								return $( "<li></li>" )
									.data( "item.autocomplete", item )
									.append( "<a>" + item.label + "</a>" )
									.appendTo( ul );
							};
			
							this.button = $( "<button type='button'>&nbsp;</button>" )
								.attr( "tabIndex", -1 )
								.attr( "title", "Show All Items" )
								.insertAfter( input )
								.button({
									icons: {
										primary: "ui-icon-triangle-1-s"
									},
									text: false
								})
								.removeClass( "ui-corner-all" )
								.addClass( "ui-corner-right ui-button-icon" )
								.click(function() {
									// close if already visible
									if ( input.autocomplete( "widget" ).is( ":visible" ) ) {
										input.autocomplete( "close" );
										return;
									}
			
									// work around a bug (likely same cause as #5265)
									$( this ).blur();
			
									// pass empty string as value to search for, displaying all results
									input.autocomplete( "search", "" );
									input.focus();
								});
						},
			
						destroy: function() {
							this.input.remove();
							this.button.remove();
							this.element.show();
							$.Widget.prototype.destroy.call( this );
						}
					});
				})( jQuery );
			
				$(function() {
					$( "#combobox" ).combobox();
					$( "#toggle" ).click(function() {
						$( "#combobox" ).toggle();
					});
				});
				</script>
			
			
				
			<div class="demo">
			
			<div class="ui-widget">
				<label>Your preferred programming language: </label>
			</div>
			<button id="toggle">Show underlying select</button>
			
			</div><!-- End demo -->


			
			#{list items:records, as:'record'}
				<tr>
					<td>
						<input type="text" value="${record.payment_date.format('yyyy/MM/dd')}"
							size="13" /> 
					</td>
					<td>
						<!-- 
						<select size="1">
							<option value="1"${record.item_id==1 ? ' selected' : ''}>食費</option>
							<option value="2"${record.item_id==2 ? ' selected' : ''}>家財住居</option>
							<option value="3"${record.item_id==3 ? ' selected' : ''}>水道光熱</option>
						</select>
						 -->

						<select id="combobox">
							<option value="1"${record.item_id==1 ? ' selected' : ''}>食費</option>
							<option value="2"${record.item_id==2 ? ' selected' : ''}>家財住居</option>
							<option value="3"${record.item_id==3 ? ' selected' : ''}>水道光熱</option>
						</select>
					</td>
				</tr>
			#{/list}
			<!-- 新規レコード -->
			<tr>
				<td>
					<input type="text" />
				</td>
				
			</tr>
		</table>
#{/if}
