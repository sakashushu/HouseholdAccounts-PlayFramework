#{extends 'main.html' /}
#{set title:'明細表' /}

<script type="text/javascript" src="@{'/public/javascripts/jquery.datepicker.js'}" ></script>

<h1>HouseholdAccounts</h1>

<h2>
	<table id="pages">
		<tr><td><a href="@{Application.index}">Home</a></td><td>明細表</td></tr>
	</table>
</h2>
<br>

<script type="text/javascript">
<!--
jQuery(document).ready(function() {
    jQuery( '#jquery-ui-dialog-opener-1' ) . click( function() {
		jQuery( '#jquery-ui-dialog-table tbody' ) . append(
		    '<tr><td></td>' +
		    '<script type="text/javascript">' +
		    '<!-- ' +
		    'jQuery.getScript("/public/javascripts/jquery.datepicker.js");' +
		    '// -->' +
		    '</scri' + 'pt>' +
		    '<td><input type="text" class="datepicker" name="n_payment_date "size="13" />' +
		    '</td>' +
		    '<td><select name="n_item_id">' + 
		    '        <option value="1" selected="selected">食費</option>' +
		    '        <option value="2">家財住居</option>' +
		    '        <option value="3">水道光熱</option>' +
		    '        <option value="999">新規作成</option>' + 
		    '    </select>' + 
			'</td>' +
		    '</tr>'
		);
    } );
} );

function AddRow() {
	var i,j,objNode,objNodeList,nLength,objResult;

	// 結果表示用 DIV
	objResult = document.getElementById( "result" );
	// 対象テーブル
	objNode = document.getElementById( "jquery-ui-dialog-table" );

	// 対象テーブル内の TR ノード
	objNodeList = objNode.getElementsByTagName( "TR" );

	// 行数
	nLength = objNodeList.length;

	// 一行目のクローンを作成 ( TH があるので、最初の行は 1 )
	var cloneNode = objNodeList.item(1).cloneNode( true );
	// クローンノードの設定
	var nodeTDList = cloneNode.getElementsByTagName( "TD" );
	nodeTDList.item( 0 ).firstChild.nodeValue = "[0001]";
	nodeTDList.item( 1 ).style.cssText = "font-weight: bold";
	// 個別設定
//	nodeTDList.item( 1 ).style.fontWeight = "bold";
	nodeTDList.item( 2 ).setAttribute("align", "right");

	// ２行目の前に追加
	// insertBefore を実行する為に、TR ノードの親ノードを取得
	var parentNode = objNodeList.item(1).parentNode;
	parentNode.insertBefore( cloneNode, objNodeList[2] );

	alert( parentNode.nodeName );
	// 以下でも同様
//	var parentNode = objNode.getElementsByTagName( "TBODY" )[0];
//	parentNode.insertBefore( cloneNode, objNodeList[2] );

}
// -->
</script>


#{form @detailList()}
	<script type="text/javascript">
	<!--
	jQuery(document).ready(function() {
		var dates = jQuery("#from, #to").datepicker({
			defaultDate: "+1w",
			changeMonth: true,
			numberOfMonths: 1,
			showOtherMonths: true,
			selectOtherMonths: true,
			showAnim: "drop",
			changeMonth: true,
			changeYear: true,
			yearRange: '1900:2999',
			dateFormat: 'yy/mm/dd',
			onSelect: function( selectedDate ) {
				var option = this.id == "from" ? "minDate" : "maxDate",
					instance = jQuery( this ).data( "datepicker" ),
					date = jQuery.datepicker.parseDate(
						instance.settings.dateFormat ||
						jQuery.datepicker._defaults.dateFormat,
						selectedDate, instance.settings );
				dates.not( this ).datepicker( "option", option, date );
			}
		});
	});
	// -->
	</script>

	
	<table id="jquery-ui-dialog-table" class="ui-widget ui-widget-content" border="1">
		<thead>
			<tr>
				<th>
					<input type="submit" name="srch" value="絞込" />
				</th>
				<th>日付<br>
					<input type="text" id="from" name="h_payment_date_fr" size="13" value="${h_payment_date_fr}" />
					<label for="to">～</label><br>
					<input type="text" id="to" name="h_payment_date_to" size="13" value="${h_payment_date_to}" />
				</th>
				<th>項目<br>
					<select id="h_combo" name="h_item_id">
						<option value="0"${h_item_id==0 ? ' selected' : ''}>すべて</option>
						<option value="1"${h_item_id==1 ? ' selected' : ''}>食費</option>
						<option value="2"${h_item_id==2 ? ' selected' : ''}>家財住居</option>
						<option value="3"${h_item_id==3 ? ' selected' : ''}>水道光熱</option>
					</select>
				</th>
			</tr>
		</thead>
		<tbody>
		#{if records.size() > 0}
			<!-- 取得レコード(編集可) -->
			#{list items:records, as:'record'}
				<tr>
					<td>
test
					</td>
					<td>
						<input type="text" class="datepicker" name="e_payment_date"
							value="${record.payment_date.format('yyyy/MM/dd')}" size="13" />
					</td>
					<td>
						<script type="text/javascript">
						<!--
						jQuery(document).ready(function() {
							// コンボボックスの要素の変更のイベントハンドラー
							jQuery("#e_combo_${record.id}").bind('change', function() {
								var selval = jQuery('#e_combo_${record.id} option:selected').val();
								if(selval=="999") {
									window.alert('新規です');
								}
							});
						});
						// -->
						</script>
					
						<select id="e_combo_${record.id}" name="e_item_id">
							<option value="1"${record.item_id==1 ? ' selected' : ''}>食費</option>
							<option value="2"${record.item_id==2 ? ' selected' : ''}>家財住居</option>
							<option value="3"${record.item_id==3 ? ' selected' : ''}>水道光熱</option>
							<option value="999">新規作成</option>
						</select>
					</td>
				</tr>
				
				<input type="hidden" name="e_id" value="${record.id}"/>
			#{/list}
		#{/if}
		</tbody>
		
	</table>
	
    <br>
    <a id="jquery-ui-dialog-opener" class="aBtn" onClick='AddRow()' href="#">行追加</a>
    <br>
    <br>

	#{if records.size() > 0}
		<input type="submit" name="save" value="保存" />
	#{/if}

#{/form}

