#{extends 'main.html' /}
#{set title:messages.get('secure.title') /}

#{set 'moreHeader'}
	<nav id="bt-menu" class="bt-menu invisible">
		<a href="#" id="bt-menu-trigger" class="bt-menu-trigger"><span>Menu</span></a>
	</nav>
#{/set}


#{include 'dialogForm.html' /}
#{include 'facebookLogin.html' /}

<script type="text/javascript">
<!-- 
/* 「Facebookでログイン」クリック時は「login()」イベントへ */
jQuery(function() {
	jQuery('#fb-login').click(function() {
		login("&{'views.login.fbLogin.dialogTitle'}");
	});
	
	jQuery('#signin').click(function(e) {
		e.preventDefault();
		
		//支払いステータスチェック
		strErrMsg = "Common.checkPplStatus";
		var em = jQuery('#saUsername').val(),
			pw = jQuery('#saPassword').val(),
			jqxhrPplChkStts = jQuery.post('@{Common.checkPplStatus}', {email: em, password: pw});
		jqxhrPplChkStts
		.done(function(z) {
			switch (z.intRslt) {
				case 0:
					jQuery('#fmAuthenticate').submit();
					break;
				case 99:
					alert(z.strErr);
					break;
				default:
					strErrMsg += " result Error";
					alert(strErrMsg);
			}
		})
		.fail(function() {
			strErrMsg += " Failed";
			alert(strErrMsg);
			e.preventDefault();
		});
	});
});
// -->
</script>


<!-- 
<img src="/public/images/background_test.jpg" alt="" id="bg-img" />
 -->

<div id="login">
	
	<h1>&{'secure.title'}</h1>
		
	<div class="box">
		<div id="loginSns">
			<p>&{'views.login.sns.title'}</p>
			<a id="fb-login" class="btn blCenter" tabindex="0">
				<div><img src="/public/images/f_logo_18.png" border="0" /></div>
				<div>&{'views.login.fbLogin.button.text'}</div>
			</a>
		</div>  <!-- loginSns -->
		
			<div id="loginOrg">
		#{form @authenticate(), id:'fmAuthenticate'}
				<p>&{'views.login.normal.title'}</p>
				#{if flash.error}
					<p class="error">
						&{flash.error}
					</p>
				#{/if}
				#{if flash.success}
					<p class="success">
						&{flash.success}
					</p>
				#{/if}
				
				<p id="username-field">
					<label for="username">&{'secure.username'}</label>
					<input type="text" name="username" id="saUsername" value="${flash.username}" />
					<input type="text" id="saUsername2" class="invisible" />
				</p>
				<p id="password-field">
					<label for="password">&{'secure.password'}</label>
					<input type="password" name="password" id="saPassword" value="${flash.password}" />
					<input type="password" id="saPassword2" class="invisible" />
				</p>
				<input type="submit" name="signin" style="display: none;" />
		#{/form}
				<p id="signin-field">
					<input type="submit" id="signin" class="grayBtn" value="&{'secure.signin'}" />
				</p>
			</div>
	</div>  <!-- box -->
</div>  <!-- login -->
