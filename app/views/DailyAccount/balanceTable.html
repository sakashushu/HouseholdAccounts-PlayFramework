#{extends 'main.html' /}
#{set title:messages.get('views.dailyaccount.balancetable') /}

%{
	REMAINDER_TYPE_TOTAL = messages.get('RemainderType.total')
	REMAINDER_TYPE_REAL = messages.get('RemainderType.real')
	REMAINDER_TYPE_IDEAL_DEPOSIT = messages.get('RemainderType.ideal_deposit')
	REMAINDER_TYPE_NOT_IDEAL_DEPOSIT = messages.get('RemainderType.not_ideal_deposit')
	HANDLING_TYPE_CASH = messages.get('HandlingType.cash')
	HANDLING_TYPE_BANK = messages.get('HandlingType.bank')
	HANDLING_TYPE_EMONEY = messages.get('HandlingType.emoney')
	HANDLING_TYPE_CRECA = messages.get('HandlingType.creca')
	IDEPO_TYPE_IDEPO = messages.get('IdepoType.idepo')
}%

<script type="text/javascript">
<!--
var bolDlgFrmUpdMstInsBkem,
	bolDlgFrmUpdMstInsIdepo,
	bolDlgFrmUpdMstUpdBkem,
	bolDlgFrmUpdMstUpdIdepo,
	strTypeName,
	lngUpdId;
jQuery(function() {
	/* table-cell内の文字列が入りきらない場合の調整 */
	var btCateSmallMaxWidth = parseInt(jQuery('.bt_cate_small').css('max-width').replace("px", "")),
		vYear, vMonth, vSelected;
	jQuery('.bt_cate_small').each(function() {
		var jTh = jQuery(this),
			strTh = jTh.text(),
			strThOrg = jTh.text(),
			strThEllipse;
		if (jTh.width()>btCateSmallMaxWidth) {
			strTh = strTh.slice(0, strTh.length-1);
			while(jTh.width()>btCateSmallMaxWidth) {
				strTh = strTh.slice(0, strTh.length-1);
				strThEllipse = strTh+"...";
				jTh.text(strThEllipse);
			}
			jTh.append("<span>"+strThOrg+"</span>");
		}
	});
	jQuery('.bt_cate_small span').each(function() {
		jQuery(this)
			.css('top', jQuery(this).parent().position().top+10)
			.css('left', jQuery(this).parent().position().left+10);
	});
	
	/* 起動時の日毎の部分の幅と高さを調整 */
//	jQuery('#bt_tcol').height(jQuery(window).innerHeight()-160);
	
	/* ウィンドウリサイズ時の日毎の部分の幅と高さを調整 */
//	jQuery(window).resize(function() {
//		jQuery('#bt_tcol').height(jQuery(this).innerHeight()-160);
//	});
	
	/* 年コンボボックスのリスト作成 */
	%{year = sBasisDate.substring(0,4)}%
	vYear = Number("${year}"), vSelected;
	for(i=1900; i<3000; i++) {
		vSelected = "";
		if (vYear===i) vSelected = " selected";
		jQuery('#idYear').append("<option value='"+i+"'"+vSelected+">"+i+"</option>");
	}
	
	/* 月コンボボックスのリスト作成 */
	vMonth = Number("${month}");
	for(i=1; i<=12; i++) {
		vSelected = "";
		if (vMonth===i) vSelected = " selected";
		jQuery('#idMonth').append("<option value='"+i+"'"+vSelected+">"+i+"</option>");
	}
	
	/* 年月コンボボックス選択変更時はjumpイベントへ */
	jQuery('#idYear, #idMonth').change(function() {
		jQuery('#idBasisDate').val(jQuery('#idYear').val()+"/"+("0"+jQuery('#idMonth').val()).slice(-2)+"/${sBasisDate.substring(8,10)}");
		jQuery('#idMove').click();
		jQuery('body').attr("disabled", "disabled");
	});
	
	/* 日付移動リンクEnter時はクリックイベントへ */
	jQuery('#idPreMonth, #idNextMonth').keypress(function(e) {
		if (e.which===13) {
			e.preventDefault();
			jQuery(this).click();
		}
	});
	
	/* 日付移動リンククリック時はjumpイベントへ */
	jQuery('#idPreMonth, #idNextMonth').click(function() {

		//移動種別
		jQuery('#idMoveType').val("&{'views.dailyaccount.movetype.month'}");
		
		//移動数
		if (this.id==="idPreMonth")
			jQuery('#idMoveNum').val('-1');
		if (this.id==="idNextMonth")
			jQuery('#idMoveNum').val('1');
		
		jQuery('#idMove').click();
		jQuery('body').attr("disabled", "disabled");
	});
	
//	/* 表示金額を3桁区切りに */
//	jQuery('.num3').each(function(i) {
//		var numStr = addFigure(jQuery(this).html());
//		jQuery(this).html(numStr);
//	});
	
	/* 日付選択時にjumpするdatepicker */
	jQuery(".datepickerJump").datepicker({
		changeMonth: true,
		numberOfMonths: 1,
		showOtherMonths: true,
		selectOtherMonths: true,
		showAnim: "drop",
		changeMonth: true,
		changeYear: true,
		yearRange: '1900:2999',
		dateFormat: 'yy/mm/dd',
		onSelect: function( e_basis_date ) {
//			var str_tmp = new String(e_basis_date).replace(/\//g, "");
//			var int_basis_date = Number(str_tmp);
			jQuery('#idBasisDate').val(e_basis_date);
			jQuery('#idMove').click();
			jQuery('body').attr("disabled", "disabled");
		},
		showOn: "button",
		buttonImage: "@{'/public/images/calendar_shu.gif'}",
		buttonImageOnly: true,
		buttonText: "カレンダー",
		showButtonPanel: true
	});
	
	/* 左クリックか右クリックでメニュー表示 */
	jQuery('.menu_cell').mousedown(function(e) {
		if (e.which===1 || e.which===3) {
			jQuery('#hHandlingId').val('');
			jQuery('#idDlRiHdIdealDepositId').val('');
			bolDlgFrmUpdMstInsBkem = false;
			bolDlgFrmUpdMstInsIdepo = false;
			bolDlgFrmUpdMstUpdBkem = false;
			bolDlgFrmUpdMstUpdIdepo = false;
			lngUpdId = null;
			
			if (jQuery('.lHandlingId', jQuery(this).parent("li")).val()!=undefined) {
				bolDlgFrmUpdMstUpdBkem = true;
				strTypeName = jQuery('.strTypeName',  jQuery(this).parent("li")).val();
				lngUpdId = parseInt(jQuery('.lHandlingId', jQuery(this).parent("li")).val(), 10);
				
				//残高明細（口座系）へジャンプする際の絞込項目セット
				jQuery('#hDebitDateFr').val(jQuery('.ToDlDebitDateFr', jQuery(this).parent("li")).val());
				jQuery('#hDebitDateTo').val(jQuery('.ToDlDebitDateTo', jQuery(this).parent("li")).val());
				jQuery('#hHandlingId').val(jQuery('.lHandlingId', jQuery(this).parent("li")).val());
			}
			if (jQuery('.lIdealDepositId', jQuery(this).parent("li")).val()!=undefined) {
				bolDlgFrmUpdMstUpdIdepo = true;
				lngUpdId = parseInt(jQuery('.lIdealDepositId', jQuery(this).parent("li")).val(), 10);
				
				//残高明細（My貯金）へジャンプする際の絞込項目セット
				jQuery('#idDlRiHdDebitDateFr').val(jQuery('.ToDlDebitDateFr', jQuery(this).parent("li")).val());
				jQuery('#idDlRiHdDebitDateTo').val(jQuery('.ToDlDebitDateTo', jQuery(this).parent("li")).val());
				jQuery('#idDlRiHdIdealDepositId').val(jQuery('.lIdealDepositId', jQuery(this).parent("li")).val());
			}
			
			if (jQuery('.bolRemReal', jQuery(this).parent("li")).val()!=undefined)
				bolDlgFrmUpdMstInsBkem = true;
			if (jQuery('.bolRemIdeal', jQuery(this).parent("li")).val()!=undefined)
				bolDlgFrmUpdMstInsIdepo = true;
			
			e.preventDefault();
			jQuery('.menu_cell').contextMenu({x: e.pageX, y: e.pageY});
		}
	});
	jQuery.contextMenu({
		selector: '.menu_cell',
		trigger: 'none',
		build: function($trigger, e) {
			var options = {
				callback: function(key, options) {
					if (key==="dialogFrmUpdMstInsBank" || key==="dialogFrmUpdMstUpdBank")
						//口座更新フォームを開く
						openDialogFrmUpdMst("${HANDLING_TYPE_BANK}", lngUpdId);
					if (key==="dialogFrmUpdMstInsEmoney" || key==="dialogFrmUpdMstUpdEmoney")
						//電子マネー更新フォームを開く
						openDialogFrmUpdMst("${HANDLING_TYPE_EMONEY}", lngUpdId);
					if (key==="dialogFrmUpdMstInsIdepo" || key==="dialogFrmUpdMstUpdIdepo")
						//My貯金更新フォームを開く
						openDialogFrmUpdMst("${IDEPO_TYPE_IDEPO}", lngUpdId);
					if (key==="toDlRemainderBank") {
						jQuery('#submitDlRemainderBank').click();
						jQuery('body').attr("disabled", "disabled");
					}
					if (key==="toDlRemainderIdeal") {
						jQuery('#submitDlRemainderIdeal').click();
						jQuery('body').attr("disabled", "disabled");
					}
				},
				items: {}
			};
			if (bolDlgFrmUpdMstInsBkem) {
				options.items.dialogFrmUpdMstInsBank = {name: "&{'views.contextMenu.add', HANDLING_TYPE_BANK}"};
				options.items.dialogFrmUpdMstInsEmoney = {name: "&{'views.contextMenu.add', HANDLING_TYPE_EMONEY}"};
			}
			if (bolDlgFrmUpdMstInsIdepo)
				options.items.dialogFrmUpdMstInsIdepo = {name: "&{'views.contextMenu.add', IDEPO_TYPE_IDEPO}"};
			if (bolDlgFrmUpdMstUpdBkem) {
				if (strTypeName==="${HANDLING_TYPE_BANK}")
					options.items.dialogFrmUpdMstUpdBank = {name: "&{'views.contextMenu.upd', HANDLING_TYPE_BANK}"};
				if (strTypeName==="${HANDLING_TYPE_EMONEY}")
					options.items.dialogFrmUpdMstUpdEmoney = {name: "&{'views.contextMenu.upd', HANDLING_TYPE_EMONEY}"};
			}
			if (bolDlgFrmUpdMstUpdIdepo) {
				options.items.dialogFrmUpdMstUpdIdepo = {name: "&{'views.contextMenu.upd', IDEPO_TYPE_IDEPO}"};
			}
			if (jQuery('#hHandlingId').val()!='')
				options.items.toDlRemainderBank = {name: "&{'views.common.menu.toDlRemainderBank'}"};
			if (jQuery('#idDlRiHdIdealDepositId').val()!='')
				options.items.toDlRemainderIdeal = {name: "&{'views.common.menu.toDlRemainderIdeal'}"};
			return options;
		}
	});
	
	jQuery('#zeroHddnBkem, #zeroHddnIdepo, #invHddnBkem').click(function() {
		var strErrMsg = "Common.updateHaUserFlg",
			jqxhr,
			jqThisChkd = jQuery(this).is(':checked'),
			strClm,
			jqChgInvisible,
			strInvisible;
		if (this.id==="zeroHddnBkem") {
			strClm = "zero_hidden_bkem";
			jqChgInvisible = jQuery('.remBkemZero');
			strInvisible = "invisible";
		}
		if (this.id==="zeroHddnIdepo") {
			strClm = "zero_hidden_idepo";
			jqChgInvisible = jQuery('.remIdepoZero');
			strInvisible = "invisible";
		}
		if (this.id==="invHddnBkem") {
			strClm = "inv_hidden_bkem";
			jqChgInvisible = jQuery('.remBkemInv');
			strInvisible = "invisible2";
		}
		jqxhr = jQuery.post('@{Common.updateHaUserFlg}', {strClm: strClm, bolFlg: jqThisChkd});
		jqxhr
		.done(function(z) {
			switch (z.intRslt) {
				case 0:
					if (jqThisChkd) {
						jqChgInvisible.addClass(strInvisible);
					} else {
						jqChgInvisible.removeClass(strInvisible);
					}
					break;
				case 99:
					alert(z.strErr);
					break;
				default:
					strErrMsg += " result Error";
					alert(strErrMsg);
			}
		})
		.fail(function() {
			strErrMsg += " Failed";
			alert(strErrMsg);
		});
	});
});

/* 文字列を3桁区切りにする関数 */
function addFigure(str) {
	var num = new String(str).replace(/,|\n| |\t/g, "");
//	while(num != (num = num.replace(/^(-?\d+)(\d{3})/, "$1,$2")));
	num = num.replace(/(\d)(?=(\d{3})+$)/g , '$1,');
	return num;
}
// -->
</script>

<script type="text/javascript" src="@{'/public/javascripts/jquery.datepicker.js'}" ></script>
<script type="text/javascript" src="@{'/public/javascripts/autoNumeric-1.7.5.js'}" ></script>
<script type="text/javascript" src="@{'/public/javascripts/jquery.contextMenu.js'}"></script>
<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/jquery.contextMenu.css'}" />

#{include 'dialogFrmUpdMst.html' /}
<script type="text/javascript">
<!--
/* dialogFrmUpdMstを閉じた時の動作は呼び出し元で行う */
function whenDialogFrmUpdMstClosed(intRslt, strType, nameVal, zeroHddnChkd, invFlgChkd, lngId) {
	var strErrMsg;
	if (lngId===null) lngId=undefined;
	if (strType==="${HANDLING_TYPE_BANK}" || strType==="${HANDLING_TYPE_EMONEY}")
		strErrMsg = "Common.updateHdlg";
	if (strType==="${IDEPO_TYPE_IDEPO}")
		strErrMsg = "Common.updateIdepo";
	switch (intRslt) {
		case 0:
			break;
		case 1:
			var jqxhrUpdMst;
			if (strType==="${HANDLING_TYPE_BANK}" || strType==="${HANDLING_TYPE_EMONEY}") {
				jqxhrUpdMst = jQuery.post('@{Common.updateHdlg}', {strType: strType, strName: nameVal, bolZeroHddn: zeroHddnChkd, bolInvFlg: invFlgChkd, lngId: lngId});
			}
			if (strType==="${IDEPO_TYPE_IDEPO}") {
				jqxhrUpdMst = jQuery.post('@{Common.updateIdepo}', {strName: nameVal, bolZeroHddn: zeroHddnChkd, lngId: lngId});
			}
			jqxhrUpdMst
			.done(function(z) {
				switch (z.intRslt) {
					case 0:
						if (strType==="${HANDLING_TYPE_BANK}" ||
								strType==="${HANDLING_TYPE_EMONEY}" ||
								strType==="${IDEPO_TYPE_IDEPO}") {
							//画面を再表示
							window.location.reload(true);
						}
						break;
					case 99:
						alert(z.strErr);
						break;
					default:
						strErrMsg += " result Error";
						alert(strErrMsg);
				}
			})
			.fail(function() {
				strErrMsg += " Failed";
				alert(strErrMsg);
			});
			break;
		default:
			alert("dialogFrmUpdMst return value error");
	}
}

google.load('visualization', '1', {'packages':['corechart']});
google.setOnLoadCallback(drawChart);
function drawChart() {
	var data = new google.visualization.DataTable();
	data.addColumn('string', 'type');
	
	data.addColumn('number', "${REMAINDER_TYPE_TOTAL}");
	data.addColumn({type: 'string', role: 'tooltip'});
	#{list items:lWDA, as:'lwda'}
	  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
			lwda.sItem!='' &&
			lwda.lstWdtd[0].lAmount!=0}
		data.addColumn('number', '${lwda.sItem}');
		data.addColumn({type: 'string', role: 'tooltip'});
	  #{/if}
	#{/list}
	
	#{list items:lWDA, as:'lwda'}
	  #{if lwda.sLargeCategory!=REMAINDER_TYPE_REAL &&
			(lwda.sItem!='' || lwda.sLargeCategory==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT) &&
			lwda.lstWdtd[0].lAmount!=0}
		data.addColumn('number', '${lwda.sLargeCategory==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT ? lwda.sLargeCategory : lwda.sItem}');
		data.addColumn({type: 'string', role: 'tooltip'});
	  #{/if}
	#{/list}
	
	data.addRows([
		["${REMAINDER_TYPE_TOTAL}",
			#{list items:lWDA, as:'lwda'}
			  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
					lwda.sItem==''}
				${lwda.lstWdtd[0].lAmount}, "${REMAINDER_TYPE_TOTAL} : "+"${lwda.lstWdtd[0].lAmount.format('###,###')}",
			  #{/if}
			#{/list}
			#{list items:lWDA, as:'lwda'}
			  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
					lwda.sItem!='' &&
					lwda.lstWdtd[0].lAmount!=0}
				0, "",
			  #{/if}
			  #{if lwda.sLargeCategory!=REMAINDER_TYPE_REAL &&
					(lwda.sItem!='' || lwda.sLargeCategory==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT) &&
					lwda.lstWdtd[0].lAmount!=0}
				0, "",
			  #{/if}
			#{/list}
		],
		["${REMAINDER_TYPE_REAL}",
			0, "",
			#{list items:lWDA, as:'lwda'}
			  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
					lwda.sItem!='' &&
					lwda.lstWdtd[0].lAmount!=0}
				${lwda.lstWdtd[0].lAmount}, "${lwda.sItem} : "+"${lwda.lstWdtd[0].lAmount.format('###,###')}",
			  #{/if}
			  #{if lwda.sLargeCategory!=REMAINDER_TYPE_REAL &&
					(lwda.sItem!='' || lwda.sLargeCategory==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT) &&
					lwda.lstWdtd[0].lAmount!=0}
				0, "",
			  #{/if}
			#{/list}
		],
		["${REMAINDER_TYPE_IDEAL_DEPOSIT}",
			0, "",
			#{list items:lWDA, as:'lwda'}
			  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
					lwda.sItem!='' &&
					lwda.lstWdtd[0].lAmount!=0}
				0, "",
			  #{/if}
			  #{if lwda.sLargeCategory!=REMAINDER_TYPE_REAL &&
					(lwda.sItem!='' || lwda.sLargeCategory==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT) &&
					lwda.lstWdtd[0].lAmount!=0}
				${lwda.lstWdtd[0].lAmount}, "${lwda.sLargeCategory==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT ? lwda.sLargeCategory : lwda.sItem} : "+"${lwda.lstWdtd[0].lAmount.format('###,###')}",
			  #{/if}
			#{/list}
		],
	]);
	
	// グラフのオプションを指定する
	var options = {
//			title: '業績推移',
			width: 980,
			height: 150,
			isStacked: true,
//			backgroundColor: { fill:'transparent' },
//			backgroundColor: "rgb(242,236,191)",
			backgroundColor: "rgb(242,223,182)",
	}
	
	// 描画する
	var chart = new google.visualization.BarChart(document.getElementById('btChart'));
	chart.draw(data, options);
}
// -->
</script>



#{set 'moreMenu'}
	#{include 'headerMenu.html' /}
#{/set}

#{set 'headerTools'}
	#{include 'headerTools.html' /}
#{/set}


<!-- 残高明細（口座系）へジャンプ用フォーム（非表示） -->
#{form @DetailList.dl_remainderBank(), class:'invisible'}
	<input type="text" name="h_secret_rec_flg" id="hSecretRecFlg" value="0" />
	<input type="text" name="h_debit_date_fr" id="hDebitDateFr" />
	<input type="text" name="h_debit_date_to" id="hDebitDateTo" />
	<input type="text" name="h_handling_id" id="hHandlingId" />
	<input type="submit" name="srch" id="submitDlRemainderBank" />
#{/form}

<!-- 残高明細（My貯金）へジャンプ用フォーム（非表示） -->
#{form @DetailList.dl_remainderIdeal(), class:'invisible'}
	<input type="text" name="dlRiHdSecretRecFlg" id="idDlRiHdSecretRecFlg" value="0" />
	<input type="text" name="dlRiHdDebitDateFr" id="idDlRiHdDebitDateFr" />
	<input type="text" name="dlRiHdDebitDateTo" id="idDlRiHdDebitDateTo" />
	<input type="text" name="dlRiHdIdealDepositId" id="idDlRiHdIdealDepositId" />
	<input type="submit" name="dlRiSrch" id="submitDlRemainderIdeal" />
#{/form}

	
#{ifErrors}
	<p class="crudFlash flashError">
		#{errors}
			${error}
		#{/errors}
	</p>
#{/ifErrors}

<!-- 日付移動用フォーム（非表示） -->
#{form @jump(), id:'frmJump', class:'invisible'}
	<input type="hidden" value="${strTableType}" name="strTableType" />
 
	<!-- 移動種別 -->
	<input type="text" name="strMoveType" id="idMoveType" />
	<!-- 移動数 -->
	<input type="text" name="intMoveNum" id="idMoveNum" />
 	
	<input type="text" name="e_basis_date" id="idBasisDate"
		value="${sBasisDate}" />
	
	<input type="submit" name="move" id="idMove" />
#{/form}

<div id="btChart"></div>

<div id="mainInner" class="btMainInner">

<div id="btBasisDate">
	<a id="idPreMonth" class="aBtn fontJura" tabindex="0"><<span>&{'views.dailyaccount.movetype.month.pre'}</span></a>
	<span id="daPaddingYearMonth">
	
		<select id="idYear">
		</select>
		&{'year'}
		<select id="idMonth">
		</select>
		&{'month'}
		&nbsp;&nbsp;
		<span>
		${sBasisDate.substring(8,10)}
		</span>
		&nbsp;
		&{'views.common.day'}
		<div class="inlineVerticalMiddle">
			<input type="text" class="datepickerJump invisible dpClImg"
				value="${sBasisDate}" />
		</div>
		
	</span>
	
	<a id="idNextMonth" class="aBtn fontJura" tabindex="0">><span>&{'views.dailyaccount.movetype.month.next'}</span></a>
</div>

<div id="btRemTotal">
	<ul>
		<li class="${vRemBkemZero} ${vInvisible} ${vRemBkemInv} ${vInvisible2}">
			<div class="t_Line lrb_Line">
				${REMAINDER_TYPE_TOTAL}
			</div>
			<div class="t_Line lrb_Line padR4 numeric">
				#{list items:lWDA, as:'lwda'}
				  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
						lwda.sItem==''}
					${lwda.lstWdtd[0].lAmount.format('###,###')}
				  #{/if}
				#{/list}
			</div>
		</li>
	</ul>
</div>

<ul id="bt_tbl_all">
	<li>
		<div id="bt_tcol">
			<div class="bt_tbl_all_l">
				<div>
					%{
						hU=models.HaUser.find("byEmail", session.username).first()
						intHdlgInvCnt=models.HandlingMst.count("ha_user = ? and handling_type_mst.handling_type_name != ? and invalidity_flg = true", hU, HANDLING_TYPE_CRECA)
						intHdlgZeroExist=false
					}%
					#{list items:lWDA, as:'lwda'}
					  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
					  		lwda.sItem!='' &&
					  		lwda.sItem!=HANDLING_TYPE_CASH &&
					  		lwda.lstWdtd[0].lAmount==0}
						%{intHdlgZeroExist = true}%
					  #{/if}
					#{/list}
					<div class="btHddnChkBox">
					#{if intHdlgZeroExist}
						<input type="checkbox" id="zeroHddnBkem" ${hU?.zero_hidden_bkem ? 'checked' : ''} />&{'views.balancetable.lbl.zero_hidden'}
					#{/if}
					#{if intHdlgInvCnt!=0}
						<input type="checkbox" id="invHddnBkem" ${hU?.inv_hidden_bkem ? 'checked' : ''} />&{'views.balancetable.lbl.invalid_hidden'}
					#{/if}
					</div>
				</div>
				
				<ul class="bt_tbl_each">
					%{topFlg = 1}%
					#{list items:lWDA, as:'lwda'}
					  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL}
					  	%{
					  		wdtd = lwda.lstWdtd[0]
					  		vRemBkemZero = (lwda.sItem!='' && lwda.sItem!=HANDLING_TYPE_CASH && wdtd.lAmount==0) ? 'remBkemZero' : ''
					  		vInvisible = (hU?.zero_hidden_bkem && lwda.lstWdtd[0].lAmount==0) ? 'invisible' : ''
					  		vRemBkemInv = (lwda.sItem!='' && lwda.sItem!=HANDLING_TYPE_CASH && lwda.bolInvFlg) ? 'remBkemInv' : ''
					  		vInvisible2 = (hU?.inv_hidden_bkem && lwda.bolInvFlg) ? 'invisible2' : ''
							vMenuCell = lwda.sItem==HANDLING_TYPE_CASH ? '' : 'menu_cell'
					  	}%
						<li class="${vRemBkemZero} ${vInvisible} ${vRemBkemInv} ${vInvisible2}">
							#{if lwda.sItem == ''}
								<input type="hidden" class="bolRemReal" value="${lwda.sLargeCategory}" />
								<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_cate_large menu_cell">
									${lwda.sLargeCategory}
								</div>
								<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_ary_day numeric menu_cell">
									<span class="padR4">${wdtd.lAmount.format('###,###')}</span>
								</div>
							#{/if}
							#{else}
								<input type="hidden" class="lHandlingId" value="${wdtd.lHandlingId}" />
								<input type="hidden" class="strTypeName" value="${lwda.strTypeNm}" />
								
								<input type="hidden" class="ToDlDebitDateFr" value="${wdtd?.sDebitDateFr}" />
								<input type="hidden" class="ToDlDebitDateTo" value="${wdtd?.sDebitDateTo}" />
<!-- 
								<input type="hidden" class="ToDlHandlingId" value="${wdtd?.lHandlingId}" />
 -->
								<div class="bt_cate_small_pre"></div>
								<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_cate_small ${vMenuCell}">
									${lwda.sItem}
								</div>
								<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_ary_day numeric ${vMenuCell}">
									<span class="padR4">${wdtd.lAmount.format('###,###')}</span>
								</div>
							#{/else}
						</li>
						%{topFlg = 0}%
					  #{/if}
					#{/list}
				</ul>
			</div>
			
			<div class="bt_tbl_all_r">
				<div>
					%{
						intIdepoZeroExist=false
					}%
					#{list items:lWDA, as:'lwda'}
					  #{if lwda.sLargeCategory!=REMAINDER_TYPE_REAL &&
					  		lwda.sItem!='' &&
					  		lwda.lstWdtd[0].lAmount==0}
						%{intIdepoZeroExist = true}%
					  #{/if}
					#{/list}
					<div class="btHddnChkBox">
					#{if intIdepoZeroExist}
						<input type="checkbox" id="zeroHddnIdepo" ${hU?.zero_hidden_idepo ? 'checked' : ''} />&{'views.balancetable.lbl.zero_hidden'}
					#{/if}
					</div>
				</div>
				
				<ul class="bt_tbl_each">
					%{topFlg = 1}%
					<li>
						#{list items:lWDA, as:'lwda'}
						  #{if lwda.sLargeCategory==REMAINDER_TYPE_REAL &&
								lwda.sItem==''}
							<input type="hidden" class="bolRemIdeal" value="${REMAINDER_TYPE_IDEAL_DEPOSIT}" />
							<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_cate_large menu_cell">
								${REMAINDER_TYPE_IDEAL_DEPOSIT}
							</div>
							<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line da_ary_day numeric menu_cell">
								<span class="padR4">${lwda.lstWdtd[0].lAmount.format('###,###')}</span>
							</div>
						  #{/if}
						#{/list}
					</li>
					
					%{topFlg = 0}%
					
					#{list items:lWDA, as:'lwda'}
					  #{if lwda.sLargeCategory!=REMAINDER_TYPE_REAL}
					  	%{
							wdtd = lwda.lstWdtd[0]
					  		vRemIdepoZero = (lwda.sItem!='' && lwda.lstWdtd[0].lAmount==0) ? 'remIdepoZero' : ''
					  		vInvisible = (hU?.zero_hidden_idepo && lwda.lstWdtd[0].lAmount==0) ? 'invisible' : ''
					  	}%
						<li class="${vRemIdepoZero} ${vInvisible}">
							<input type="hidden" class="lIdealDepositId" value="${wdtd.lIdealDepositId}" />
							
							<input type="hidden" class="ToDlDebitDateFr" value="${wdtd?.sDebitDateFr}" />
							<input type="hidden" class="ToDlDebitDateTo" value="${wdtd?.sDebitDateTo}" />
<!-- 
							<input type="hidden" class="ToDlIdealDepositId" value="${wdtd?.lIdealDepositId}" />
 -->
							#{if lwda.sItem==''}
								%{vMenuCell = lwda.sLargeCategory==REMAINDER_TYPE_IDEAL_DEPOSIT ? 'menu_cell' : ''}%
								<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_cate_large ${vMenuCell}">
									${lwda.sLargeCategory}
								</div>
							#{/if}
							#{else}
								<div class="bt_cate_small_pre"></div>
								<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line bt_cate_small ${lwda.sItem==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT ? '' : ' menu_cell'}">
									${lwda.sItem}
								</div>
							#{/else}
							<div class="${topFlg==1 ? 't_Line ' : ''}lrb_Line da_ary_day numeric${lwda.sItem==REMAINDER_TYPE_NOT_IDEAL_DEPOSIT ? '' : ' menu_cell'}">
								<span class="padR4">${wdtd.lAmount.format('###,###')}</span>
							</div>
							%{leftFlg = 0}%
						</li>
						%{topFlg = 0}%
					  #{/if}
					#{/list}
				</ul>
			</div>
		</div>
	</li>
</ul>  <!-- bt_tbl_all -->

<div id="mainInnerBtm"></div>

</div>  <!-- mainInner -->
